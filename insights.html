<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Insights | Only True Perspective</title>
  <meta name="description" content="Strategic deconstructions of visual culture, high-retention editing, and the business of creative direction." />
  
  <!-- SEO / Social -->
  <meta property="og:title" content="Insights | Only True Perspective" />
  <meta property="og:description" content="Tactical breakdowns and creative strategy from the OTP lab." />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://onlytrueperspective.tech/insights.html" />
  <link rel="canonical" href="https://onlytrueperspective.tech/insights.html" />
  <meta property="og:image" content="https://onlytrueperspective.tech/og.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="stylesheet" href="./styles.css?v=2.6" />
  <style>
    body { margin: 0 !important; }
    .filter-btn {
        background: transparent;
        border: 1px solid var(--stroke);
        color: var(--muted);
        padding: 8px 16px;
        border-radius: 30px;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .filter-btn:hover {
        border-color: var(--accent2);
        color: var(--text);
        transform: translateY(-2px);
    }
    .filter-btn.active {
        background: var(--accent2);
        border-color: var(--accent2);
        color: #000;
        font-weight: 700;
        box-shadow: 0 0 20px rgba(0, 255, 170, 0.2);
    }
    .post-tag {
        font-size: 0.65rem;
        color: var(--accent2);
        background: rgba(0, 255, 170, 0.05);
        padding: 4px 10px;
        border-radius: 4px;
        border: 1px solid rgba(0, 255, 170, 0.1);
        font-family: monospace;
        letter-spacing: 0.5px;
    }
  </style>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@400;700;800&family=Syne:wght@700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  <!-- THEME GUARD -->
  <script>
    (function() {
        const t = localStorage.getItem('theme') || localStorage.getItem('last_global_theme');
        if (t === 'light' || (!t \u0026\u0026 new Date().getHours() \u003e= 6 \u0026\u0026 new Date().getHours() \u003c 18)) {
            document.documentElement.setAttribute('data-theme', 'light');
        }
    })();
  </script>
</head>
<body class="insights-page">
  <div class="bg-fixed"></div>

  <header class="nav nav-split">
    <!-- Logo Left -->
    <a href="index.html" class="nav-logo" aria-label="OTP">
      <img src="assets/otp_v2.png" alt="OTP" class="otp-mark" />
    </a>

    <!-- Links Right -->
    <nav class="nav-links" aria-label="Primary">
      <a href="index.html#work" class="k-hover">Work</a>
      <a href="archive.html" class="k-hover">Archive</a>
      <a href="insights.html" class="active k-hover">Insights</a>

      <a href="index.html#services" class="k-hover">Services</a>
      <a href="index.html#contact" class="k-hover">Contact</a>

    </nav>

    <!-- Mobile toggle -->
    <button class="nav-toggle" type="button" aria-label="Open menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav-drawer" aria-label="Mobile">
      <a href="index.html#work">Work</a>
      <a href="archive.html">Archive</a>
      <a href="insights.html">Insights</a>

      <a href="index.html#services">Services</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </header>

  <main class="archive-main">
    <div class="wrap">
      <header class="archive-header">
        <h1 class="syne-bold">INSIGHTS</h1>
        <!-- Neural Data Core visual -->
        <div class="header-visual">
          <svg class="neon-icon neon-neural" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Hexagonal Frame -->
            <path d="M50 5 L89 27.5 V72.5 L50 95 L11 72.5 V27.5 Z" stroke="var(--accent)" stroke-width="2" class="hex-frame" />
            <!-- Inner Glowing Brain/Core -->
            <path d="M50 30 C55 30 60 35 60 40 C60 45 55 50 50 50 C45 50 40 45 40 40 C40 35 45 30 50 30" stroke="var(--accent2)" stroke-width="1.5" class="core-outline" />
            <!-- Neural Connections -->
            <path d="M50 15 V30" stroke="var(--accent)" stroke-width="1" class="neural-node node-up" />
            <path d="M50 70 V85" stroke="var(--accent)" stroke-width="1" class="neural-node node-down" />
            <path d="M25 40 H40" stroke="var(--accent)" stroke-width="1" class="neural-node node-left" />
            <path d="M60 40 H75" stroke="var(--accent)" stroke-width="1" class="neural-node node-right" />
            <!-- Data Glitch Particles -->
            <rect x="70" y="25" width="4" height="4" fill="var(--accent2)" class="glitch-particle p1" />
            <rect x="25" y="65" width="4" height="2" fill="var(--accent)" class="glitch-particle p2" />
            <path d="M40 50 L60 50" stroke="var(--accent2)" stroke-width="2" class="pulse-line-neural" />
            <circle cx="50" cy="50" r="12" fill="var(--accent2)" opacity="0.2" class="core-glow-neural" />
          </svg>
        </div>
      </header>

      <div class="center-text" style="margin-bottom: 60px;">
        <p class="muted">Blogs, updates, strategy discussions, content teasers, and cinematic deconstructions from the lab.</p>
      </div>




      <div class="insights-header">
        <h1 class="syne-extra-bold" style="font-size: clamp(3rem, 10vw, 6rem); margin-bottom: 10px;">INSIGHTS</h1>
        <p class="muted" style="max-width: 600px; margin: 0 auto 40px; font-size: 1.1rem;">Decentralized updates from the Only True Perspective network.</p>
      </div>

      <!-- TAG FILTER -->
      <div id="filter-wrap" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 40px; opacity: 0; transform: translateY(10px); transition: 0.5s;">
          <!-- Tags injected here -->
      </div>

      <div class="insights-grid">
        <!-- Content populated dynamically from Supabase -->
        <div class="loader" style="grid-column: 1/-1; text-align: center; color: var(--muted); letter-spacing: 2px;">SCANNING FREQUENCIES...</div>
      </div>

      <!-- Subscribe / Connect Section -->
      <section class="subscribe-section center-text">
        <h3 class="syne-bold">Visual Intelligence. Delivered.</h3>
        <p class="muted">Exclusive blogs, visual updates, strategy discussions, and content teasers you won't find anywhere else.</p>
        <form action="https://formspree.io/f/mwvprvll" method="POST" class="subscribe-form">
          <input type="email" name="email" placeholder="email@address.com" required>
          <button type="submit" class="k-hover">Subscribe</button>
        </form>
        <p class="muted" style="margin-top: 30px; font-style: italic;">Information is potential. Execution is power. <a href="index.html#contact" style="color: var(--accent2); text-decoration: none; font-weight: 600;">Let's build something iconic.</a></p>
      </section>


      <div class="insights-footer-nav center-text">
        <a href="index.html" class="k-hover">Home</a>
        <span class="dot">•</span>
        <a href="archive.html" class="k-hover">Archive</a>
        <span class="dot">•</span>
        <a href="index.html#contact" class="k-hover">Contact</a>
      </div>

    </div>
  </main>

  <footer class="footer">
    <div class="wrap footer-inner">
      <div class="footer-left">
        <div class="nav-logo" aria-label="OTP">
          <img src="assets/otp_v2.png" alt="OTP logo" class="nav-gif" />
        </div>
        <div class="fineprint">© <span id="year">2026</span> Only True Perspective. All rights reserved.</div>
        <div class="footer-legal">
          <a href="terms.html">Terms</a>
          <span class="dot">•</span>
          <a href="privacy.html">Privacy</a>
        </div>
      </div>

      <div class="footer-right">
        <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;">Back to top ↑</a>
      </div>
    </div>
  </footer>

  <canvas id="cursor-canvas"></canvas>

  <script src="site-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/kursor"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <script>
    // Page-specific: Fetch Insights & Spotlight Effect
    document.addEventListener("DOMContentLoaded", async () => {
        const grid = document.querySelector('.insights-grid');
        const loader = document.querySelector('.loader');

        // ...
// (Skipping down to fetch logic)

            setStatus("CONNECTING TO DATABASE...");
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            setStatus("SCANNING FOR SIGNALS...");
            const { data: posts, error } = await supabase
                .from('posts')
                .select('*')
                // .eq('published', true) // TEMPORARY DEBUG: Show all posts to rule out filter issues
                .order('created_at', { ascending: false });

            if (error) throw error;

            console.log("Fetched posts:", posts);
            setStatus(`FOUND ${posts ? posts.length : 0} SIGNALS. DECODING...`);

            if (posts) {
                allPosts = posts;
                // localStorage.setItem('otp_insights_cache', JSON.stringify(posts)); 
                if (posts.length > 0) {
                    renderPosts(posts);
                    renderFilters(posts);
                } else {
                    setStatus("NO SIGNALS DETECTED. STATION IS SILENT.");
                }
            }
        } catch (e) {
            console.error("Error fetching insights:", e);
            if (!allPosts.length) setStatus(`SIGNAL LOSS: ${e.message}`, true);
        }

        // Helper: Escape HTML to prevent XSS
        const escapeHtml = (str) => {
            if (!str) return '';
            return str.replace(/&/g, "&amp;")
                      .replace(/</g, "&lt;")
                      .replace(/>/g, "&gt;")
                      .replace(/"/g, "&quot;")
                      .replace(/'/g, "&#039;");
        };

        function renderFilters(posts) {
            const wrap = document.getElementById('filter-wrap');
            if (!wrap) return;

            // Extract unique tags
            const tags = new Set();
            posts.forEach(p => {
                if (p.tags && Array.isArray(p.tags)) {
                    p.tags.forEach(t => tags.add(t.toUpperCase()));
                }
            });

            const uniqueTags = ['ALL', ...Array.from(tags).sort()];
            
            wrap.innerHTML = uniqueTags.map(tag => `
                <button class="filter-btn ${activeTag === tag ? 'active' : ''}" onclick="window.filterByTag('${escapeHtml(tag)}')">
                    ${escapeHtml(tag)}
                </button>
            `).join('');
            
            wrap.style.opacity = '1';
            wrap.style.transform = 'translateY(0)';
        }

        window.filterByTag = (tag) => {
            activeTag = tag;
            renderPosts(allPosts);
            renderFilters(allPosts);
        };

        function renderPosts(posts) {
            if (!grid) return;
            
            const filtered = activeTag === 'ALL' 
                ? posts 
                : posts.filter(p => p.tags && p.tags.map(t => t.toUpperCase()).includes(activeTag));

            grid.innerHTML = ''; 
            
            if (filtered.length === 0) {
                setStatus(`No insights found for tag: ${activeTag}`);
                return;
            }

            filtered.forEach(post => {
                try {
                    const date = new Date(post.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    let link = `insight.html?slug=${post.slug}`;
                    if (post.slug === 'spooky-luh-ooky') link = 'spooky-luh-ooky.html';
                    
                    const card = document.createElement('article');
                    card.className = 'insight-card k-hover';

                    // Safe content extraction (strip tags)
                    let rawBody = post.excerpt || post.content || '';
                    let safeBody = rawBody.replace(/<[^>]*>/g, '').substring(0, 100) + (rawBody.length > 100 ? '...' : '');

                    card.innerHTML = `
                        <div class="insight-card-inner">
                            <div class="insight-date">${date} • ${escapeHtml(post.category || 'Insight')}</div>
                            <h2>${escapeHtml(post.title)}</h2>
                            <p>${escapeHtml(safeBody)}</p>
                            
                            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 20px;">
                                ${(post.tags || []).map(t => `<span class="post-tag">#${escapeHtml(t.toUpperCase())}</span>`).join('')}
                            </div>

                            <div class="insight-footer">
                                <a href="${link}" class="read-more">Read Insight</a>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                } catch (err) {
                    console.error("Skipping malformed post:", post, err);
                }
            });
        }
    });
  </script>

  <script src="stars-v2.js"></script>
  <script src="site-init.js?v=7.0"></script>
</body>
</html>
