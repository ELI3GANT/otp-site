<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Insights | Only True Perspective</title>
  <meta name="description" content="Strategic deconstructions of visual culture, high-retention editing, and the business of creative direction." />
  
  <!-- SEO / Social -->
  <meta property="og:title" content="Insights | Only True Perspective" />
  <meta property="og:description" content="Tactical breakdowns and creative strategy from the OTP lab." />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://onlytrueperspective.tech/insights.html" />
  <link rel="canonical" href="https://onlytrueperspective.tech/insights.html" />
  <meta property="og:image" content="https://onlytrueperspective.tech/og.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="stylesheet" href="./styles.css?v=2.6" />
  <style>body { margin: 0 !important; }</style>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@400;700;800&family=Syne:wght@700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
</head>
<body class="insights-page">
  <div class="bg-fixed"></div>

  <header class="nav nav-split">
    <!-- Logo Left -->
    <a href="index.html" class="nav-logo" aria-label="OTP">
      <img src="assets/otp_v2.png" alt="OTP" class="otp-mark" />
    </a>

    <!-- Links Right -->
    <nav class="nav-links" aria-label="Primary">
      <a href="index.html#work" class="k-hover">Work</a>
      <a href="archive.html" class="k-hover">Archive</a>
      <a href="insights.html" class="active k-hover">Insights</a>
      <a href="index.html#services" class="k-hover">Services</a>
      <a href="index.html#contact" class="k-hover">Contact</a>

    </nav>

    <!-- Mobile toggle -->
    <button class="nav-toggle" type="button" aria-label="Open menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav-drawer" aria-label="Mobile">
      <a href="index.html#work">Work</a>
      <a href="archive.html">Archive</a>
      <a href="insights.html">Insights</a>
      <a href="index.html#services">Services</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </header>

  <main class="archive-main">
    <div class="wrap">
      <header class="archive-header">
        <h1 class="syne-bold">INSIGHTS</h1>
        <!-- Neural Data Core visual -->
        <div class="header-visual">
          <svg class="neon-icon neon-neural" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Hexagonal Frame -->
            <path d="M50 5 L89 27.5 V72.5 L50 95 L11 72.5 V27.5 Z" stroke="var(--accent)" stroke-width="2" class="hex-frame" />
            <!-- Inner Glowing Brain/Core -->
            <path d="M50 30 C55 30 60 35 60 40 C60 45 55 50 50 50 C45 50 40 45 40 40 C40 35 45 30 50 30" stroke="var(--accent2)" stroke-width="1.5" class="core-outline" />
            <!-- Neural Connections -->
            <path d="M50 15 V30" stroke="var(--accent)" stroke-width="1" class="neural-node node-up" />
            <path d="M50 70 V85" stroke="var(--accent)" stroke-width="1" class="neural-node node-down" />
            <path d="M25 40 H40" stroke="var(--accent)" stroke-width="1" class="neural-node node-left" />
            <path d="M60 40 H75" stroke="var(--accent)" stroke-width="1" class="neural-node node-right" />
            <!-- Data Glitch Particles -->
            <rect x="70" y="25" width="4" height="4" fill="var(--accent2)" class="glitch-particle p1" />
            <rect x="25" y="65" width="4" height="2" fill="var(--accent)" class="glitch-particle p2" />
            <path d="M40 50 L60 50" stroke="var(--accent2)" stroke-width="2" class="pulse-line-neural" />
            <circle cx="50" cy="50" r="12" fill="var(--accent2)" opacity="0.2" class="core-glow-neural" />
          </svg>
        </div>
      </header>

      <div class="center-text" style="margin-bottom: 60px;">
        <p class="muted">Blogs, updates, strategy discussions, content teasers, and cinematic deconstructions from the lab.</p>
      </div>




      <div class="insights-grid">
        <!-- Content populated dynamically from Supabase -->
        <div class="loader" style="grid-column: 1/-1; text-align: center; color: var(--muted);">LOADING SIGNAL...</div>
      </div>

      <!-- Subscribe / Connect Section -->
      <section class="subscribe-section center-text">
        <h3 class="syne-bold">Visual Intelligence. Delivered.</h3>
        <p class="muted">Exclusive blogs, visual updates, strategy discussions, and content teasers you won't find anywhere else.</p>
        <form action="https://formspree.io/f/mwvprvll" method="POST" class="subscribe-form">
          <input type="email" name="email" placeholder="email@address.com" required>
          <button type="submit" class="k-hover">Subscribe</button>
        </form>
        <p class="muted" style="margin-top: 30px; font-style: italic;">Information is potential. Execution is power. <a href="index.html#contact" style="color: var(--accent2); text-decoration: none; font-weight: 600;">Let's build something iconic.</a></p>
      </section>


      <div class="insights-footer-nav center-text">
        <a href="index.html" class="k-hover">Home</a>
        <span class="dot">â€¢</span>
        <a href="archive.html" class="k-hover">Archive</a>
        <span class="dot">â€¢</span>
        <a href="index.html#contact" class="k-hover">Contact</a>
      </div>

    </div>
  </main>

  <footer class="footer">
    <div class="wrap footer-inner">
      <div class="footer-left">
        <div class="nav-logo" aria-label="OTP">
          <img src="assets/otp_v2.png" alt="OTP logo" class="nav-gif" />
        </div>
        <div class="fineprint">Â© <span id="year"></span> Only True Perspective. All rights reserved.</div>
        <div class="footer-legal">
          <a href="terms.html">Terms</a>
          <span class="dot">â€¢</span>
          <a href="privacy.html">Privacy</a>
        </div>
      </div>

      <div class="footer-right">
        <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;">Back to top â†‘</a>
      </div>
    </div>
  </footer>

  <canvas id="cursor-canvas"></canvas>

  <script src="site-config.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/kursor"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <script>
    // Page-specific: Fetch Insights & Spotlight Effect
    document.addEventListener("DOMContentLoaded", async () => {
        const grid = document.querySelector('.insights-grid');
        const loader = document.querySelector('.loader');

        // 1. SUPABASE FETCH (Using centralized config)
        const SUPABASE_URL = window.OTP_CONFIG ? window.OTP_CONFIG.supabaseUrl : null;
        const SUPABASE_KEY = window.OTP_CONFIG ? window.OTP_CONFIG.supabaseKey : null;
        
        const setStatus = (msg, isError = false) => {
            if (grid) {
                grid.innerHTML = `<div style="grid-column: 1/-1; text-align:center; padding: 40px; color: ${isError ? '#ff4444' : 'var(--muted)'}; opacity: 0.8;">${msg}</div>`;
            }
        };

        try {
            // 0. LOAD FROM CACHE FIRST (Instant UI)
            const cachedData = localStorage.getItem('otp_insights_cache');
            if (cachedData) {
                try {
                    const posts = JSON.parse(cachedData);
                    renderPosts(posts, true); // Render with "cached" flag
                    console.log("ðŸ’¾ Loaded from Persistence Cache");
                } catch(e) { console.error("Cache corrupt", e); }
            }

            // Check if library is loaded
            if (typeof window.supabase === 'undefined') {
                if (!cachedData) setStatus("SIGNAL INTERRUPTED: Database Library Offline.", true);
                return;
            }

            if (!SUPABASE_URL || !SUPABASE_KEY) {
                if (!cachedData) setStatus("CONFIGURATION ERROR: Missing credentials.", true);
                return;
            }

            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            const fetchPromise = supabase
                .from('posts')
                .select('*')
                .eq('published', true)
                .order('created_at', { ascending: false });

            const timeoutPromise = new Promise((_, reject) => 
                setTimeout(() => reject(new Error("Connection Timeout")), 5000)
            );

            const { data: posts, error } = await Promise.race([fetchPromise, timeoutPromise]);

            if (error) throw error;

            if (posts && posts.length > 0) {
                // 1. Update Cache
                localStorage.setItem('otp_insights_cache', JSON.stringify(posts));
                
                // 2. Render Fresh Data
                renderPosts(posts, false);
            } else if (!cachedData) {
                setStatus("NO SIGNALS DETECTED. STATION IS SILENT.");
            }
        } catch (e) {
            console.error("Error fetching insights:", e);
            if (!localStorage.getItem('otp_insights_cache')) {
                setStatus(`SIGNAL LOSS: ${e.message === 'Connection Timeout' ? 'Timed out. Check network.' : 'Failed to sync.'}`, true);
            }
        }

        function renderPosts(posts, isCached) {
            if (!grid) return;
            grid.innerHTML = ''; // Clear
            
            const seenSlugs = new Set();
            posts.forEach(post => {
                if (seenSlugs.has(post.slug)) return;
                seenSlugs.add(post.slug);

                const date = new Date(post.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                let link = `insight.html?slug=${post.slug}`;
                if (post.slug === 'spooky-luh-ooky') link = 'spooky-luh-ooky.html';
                
                const card = document.createElement('article');
                card.className = 'insight-card k-hover';

                card.innerHTML = `
                    <div class="insight-card-inner">
                        <div class="insight-date">${date} â€¢ ${post.category || 'Insight'}</div>
                        <h2>${post.title}</h2>
                        <p>${post.excerpt || (post.content ? post.content.substring(0, 100).replace(/<[^>]*>/g, '') + '...' : '')}</p>
                        <div class="insight-footer">
                            <a href="${link}" class="read-more">Read Insight</a>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Re-bind effects
            const cards = document.querySelectorAll('.insight-card');
            cards.forEach(card => {
                card.addEventListener('mousemove', e => {
                    const rect = card.getBoundingClientRect();
                    card.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
                    card.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
                });
                card.style.cursor = 'pointer';
                card.addEventListener('click', (e) => {
                    const link = card.querySelector('a.read-more');
                    if (link && e.target !== link) { link.click(); }
                });
            });

            if (typeof gsap !== 'undefined' && !isCached) {
                // Snappier, more consistent animation
                gsap.from(cards, { 
                    opacity: 0, 
                    y: 20, 
                    stagger: 0.05, 
                    duration: 0.5, 
                    ease: "power2.out",
                    clearProps: "all" // Ensure it finishes with clean styles
                });
            } else {
                cards.forEach(c => {
                    c.style.opacity = '1';
                    c.style.transform = 'none';
                });
            }
        }
    });
  </script>

  <script src="stars-v2.js"></script>
  <script src="site-init.js"></script>
</body>
</html>
