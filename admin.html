<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OTP Pocket Command</title>
  <link rel="stylesheet" href="./styles.css?v=2.6" />
  <style>body { margin: 0 !important; font-family: 'Space Grotesk', sans-serif; background: #050505; color: white; }</style>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  
    <style>
  
        :root {
  
            --accent: #7000ff;
  
            --accent2: #00c3ff;
  
            --bg: #030305;
  
            --card: rgba(255, 255, 255, 0.04);
  
            --stroke: rgba(255, 255, 255, 0.1);
  
            --success: #00ffaa;
  
        }
  
  
  
        body { 
  
            margin: 0 !important; 
  
            font-family: 'Inter', sans-serif; 
  
            background: var(--bg); 
  
            color: white; 
  
            -webkit-font-smoothing: antialiased;
  
            padding-bottom: 50px;
  
        }
  
  
  
        .admin-header {
  
            position: sticky;
  
            top: 0;
  
            background: rgba(3, 3, 5, 0.95);
  
            backdrop-filter: blur(20px);
  
            -webkit-backdrop-filter: blur(20px);
  
            padding: 15px 20px;
  
            border-bottom: 1px solid var(--stroke);
  
            z-index: 100;
  
            display: flex;
  
            justify-content: space-between;
  
            align-items: center;
  
        }
  
  
  
        .admin-header h1 { 
  
            margin: 0; 
  
            font-size: 1.1rem;
  
            letter-spacing: 2px;
  
            font-family: 'Space Grotesk', sans-serif;
  
            color: var(--accent2);
  
            text-transform: uppercase;
  
        }
  
  
  
        .admin-wrap {
  
            max-width: 800px; /* Widen for more controls */
  
            margin: 0 auto;
  
            padding: 20px;
  
            padding-bottom: 120px;
  
        }
  
        
  
        .section-label {
  
            font-family: 'Space Grotesk', sans-serif;
  
            font-size: 0.75rem;
  
            font-weight: 800;
  
            color: var(--accent);
  
            text-transform: uppercase;
  
            letter-spacing: 2px;
  
            margin: 30px 0 15px;
  
            display: flex;
  
            align-items: center;
  
            gap: 15px;
  
        }
  
        .section-label::after {
  
            content: "";
  
            flex: 1;
  
            height: 1px;
  
            background: linear-gradient(90deg, var(--accent), transparent);
  
            opacity: 0.3;
  
        }
  
  
  
        .input-group { margin-bottom: 20px; position: relative; }
  
        
  
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  
        @media (max-width: 600px) { .row { grid-template-columns: 1fr; } }
  
  
  
        label { 
  
            display: block; 
  
            margin-bottom: 8px; 
  
            font-weight: 700; 
  
            color: #888; 
  
            font-size: 0.75rem; 
  
            text-transform: uppercase;
  
            letter-spacing: 0.5px;
  
        }
  
        .desc { font-size: 0.75rem; color: #555; margin-bottom: 10px; display: block; line-height: 1.4; }
  
        
  
        input, textarea, select {
  
            width: 100%;
  
            background: rgba(255,255,255,0.03);
  
            border: 1px solid var(--stroke);
  
            color: #fff;
  
            padding: 14px;
  
            border-radius: 8px;
  
            font-family: inherit;
  
            font-size: 0.95rem;
  
            transition: all 0.2s ease;
  
        }
  
        input:focus, textarea:focus, select:focus { 
  
            border-color: var(--accent2); 
  
            background: rgba(255,255,255,0.06);
  
            outline: none; 
  
            box-shadow: 0 0 15px rgba(0, 195, 255, 0.1);
  
        }
  
        textarea { height: 120px; line-height: 1.6; resize: vertical; }
  
        
  
        /* Toggle Switch */
  
        .toggle-wrap { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.02); padding: 12px; border-radius: 8px; border: 1px solid var(--stroke); }
  
        .toggle-label { margin: 0; color: #ccc; }
  
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
  
        .switch input { opacity: 0; width: 0; height: 0; }
  
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
  
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
  
        input:checked + .slider { background-color: var(--success); }
  
        input:checked + .slider:before { transform: translateX(20px); }
  
  
  
        /* AI Panel */
  
        .ai-tips {
  
            background: linear-gradient(135deg, rgba(112, 0, 255, 0.08), rgba(0, 0, 0, 0.4));
  
            padding: 20px;
  
            border-radius: 12px;
  
            border: 1px solid rgba(112, 0, 255, 0.3);
  
            margin: 30px 0;
  
            position: relative;
  
        }
  
        .ai-tips h4 { margin: 0 0 10px 0; color: #fff; font-family: 'Space Grotesk', sans-serif; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
  
        
  
        button {
  
            width: 100%;
  
            padding: 16px;
  
            background: var(--accent2);
  
            color: #000;
  
            border: none;
  
            font-weight: 800;
  
            border-radius: 10px;
  
            font-size: 1rem;
  
            font-family: 'Space Grotesk', sans-serif;
  
            cursor: pointer;
  
            text-transform: uppercase;
  
            letter-spacing: 1px;
  
            transition: all 0.2s ease;
  
            box-shadow: 0 5px 20px rgba(0, 195, 255, 0.15);
  
        }
  
        button:active { transform: scale(0.98); opacity: 0.9; }
  
        
  
        .btn-secondary {
  
            background: transparent;
  
            border: 1px solid var(--stroke);
  
            color: #888;
  
            box-shadow: none;
  
            font-size: 0.8rem;
  
            padding: 10px;
  
        }
  
        .btn-secondary:hover { border-color: #fff; color: #fff; }
  
  
  
        /* TOAST NOTIFICATION */
  
        .toast {
  
            position: fixed;
  
            top: 20px;
  
            left: 50%;
  
            transform: translateX(-50%) translateY(-100px);
  
            background: rgba(0, 255, 170, 0.15);
  
            backdrop-filter: blur(15px);
  
            border: 1px solid var(--success);
  
            padding: 16px 24px;
  
            border-radius: 12px;
  
            display: flex;
  
            align-items: center;
  
            gap: 12px;
  
            color: var(--success);
  
            font-weight: 700;
  
            font-size: 0.9rem;
  
            letter-spacing: 1px;
  
            box-shadow: 0 10px 40px rgba(0, 255, 170, 0.2);
  
            z-index: 9999;
  
            opacity: 0;
  
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  
            pointer-events: none;
  
        }
  
        .toast.show {
  
            transform: translateX(-50%) translateY(0);
  
            opacity: 1;
  
        }
  
        .checkmark-circle {
  
            width: 24px; height: 24px;
  
            background: var(--success);
  
            border-radius: 50%;
  
            display: grid;
  
            place-items: center;
  
            color: #000;
  
            font-size: 14px;
  
        }
  
  
  
        /* Image Preview */
  
        #imagePreview {
  
            width: 100%;
  
            height: 240px;
  
            border-radius: 12px;
  
            background-size: cover;
  
            background-position: center;
  
            margin-bottom: 15px;
  
            display: none;
  
            border: 1px solid var(--stroke);
  
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  
        }
  
  
  
    </style>
  
  </head>
  
  <body>
  
  
  
    <!-- TOAST -->
  
    <div id="toast" class="toast">
  
        <div class="checkmark-circle">âœ“</div>
  
        <span>POST PUBLISHED SUCCESSFULLY</span>
  
    </div>
  
  
  
    <header class="admin-header">
  
        <h1>OTP COMMAND</h1>
  
        <div style="font-size: 0.7rem; color: #666; font-family: monospace;">V3.0 ADMIN</div>
  
    </header>
  
  
  
    <div class="admin-wrap">
  
        
  
        <form id="postForm">
  
            
  
            <!-- ACCESS -->
  
            <div class="input-group">
  
                <label>Security Clearance</label>
  
                <input type="password" id="passcode" placeholder="Enter Access Code" required autocomplete="current-password">
  
            </div>
  
  
  
            <!-- SECTION: MEDIA -->
  
            <div class="section-label">01 // Visual Intelligence</div>
  
            <div class="input-group">
  
                <div id="imagePreview"></div>
  
                <div style="display: flex; gap: 10px;">
  
                    <button type="button" class="btn-secondary" onclick="document.getElementById('fileInput').click()">Upload File</button>
  
                    <input type="file" id="fileInput" accept="image/*" style="display: none">
  
                    <input type="text" id="urlInput" placeholder="Or Paste URL..." style="border: 1px solid var(--stroke); background: transparent;">
  
                </div>
  
                <input type="hidden" name="image_url" id="imageUrl">
  
            </div>
  
  
  
            <!-- SECTION: CORE DATA -->
  
            <div class="section-label">02 // Core Data</div>
  
            
  
            <div class="input-group">
  
                <label>Headline</label>
  
                <input type="text" name="title" id="titleInput" placeholder="The Death of 1080p" required oninput="generateSlug(this.value)">
  
            </div>
  
  
  
            <div class="row">
  
                <div class="input-group">
  
                    <label>Slug</label>
  
                    <input type="text" name="slug" id="slugInput" placeholder="auto-generated" style="color: var(--accent2);">
  
                </div>
  
                <div class="input-group">
  
                    <label>Category</label>
  
                    <select name="category" id="catInput">
  
                        <option value="Strategy">Strategy</option>
  
                        <option value="Tech">Tech</option>
  
                        <option value="Production">Production</option>
  
                        <option value="Case Study">Case Study</option>
  
                    </select>
  
                </div>
  
            </div>
  
  
  
            <div class="row">
  
                <div class="input-group">
  
                    <label>Author</label>
  
                    <input type="text" name="author" value="OTP Admin">
  
                </div>
  
                <div class="input-group">
  
                    <label>Publish Date</label>
  
                    <input type="datetime-local" name="published_at">
  
                </div>
  
            </div>
  
  
  
            <!-- SECTION: AI BRAIN -->
  
            <div class="ai-tips">
  
                <h4>ðŸ¤– AUTO-GENERATOR</h4>
  
                <p style="font-size: 0.8rem; color: #aaa; margin-bottom: 15px;">Fills Content, SEO, and Metadata automatically.</p>
  
                
  
                <div class="input-group">
  
                    <input type="password" id="apiKey" placeholder="OpenAI API Key (sk-...)" onchange="localStorage.setItem('openai_key', this.value)" style="background: rgba(0,0,0,0.3);">
  
                </div>
  
                
  
                <div class="row">
  
                    <div class="input-group">
  
                         <label>Prompt Context (Optional)</label>
  
                         <textarea id="aiPrompt" placeholder="e.g. Focus on color grading workflows..." style="height: 60px;"></textarea>
  
                    </div>
  
                    <button type="button" id="magicBtn" style="height: 100%; margin-top: 23px;">âš¡ FULL AUTO GENERATE</button>
  
                </div>
  
                <div id="aiStatus" style="font-size: 0.75rem; color: var(--accent2); margin-top: 10px; min-height: 15px;"></div>
  
            </div>
  
  
  
            <!-- SECTION: CONTENT -->
  
            <div class="section-label">03 // The Meat</div>
  
            
  
            <div class="input-group">
  
                <label>Excerpt (Card Summary)</label>
  
                <textarea name="excerpt" id="excerptInput" style="height: 80px;" required></textarea>
  
            </div>
  
  
  
            <div class="input-group">
  
                <label>Full Content (Markdown/HTML)</label>
  
                <textarea name="content" id="contentArea" style="height: 400px; font-family: monospace; font-size: 0.9rem;" required></textarea>
  
            </div>
  
  
  
            <!-- SECTION: SEO & ANALYTICS -->
  
            <div class="section-label">04 // SEO & Analytics</div>
  
            
  
            <div class="input-group">
  
                <label>SEO Meta Title</label>
  
                <input type="text" name="seo_title" id="seoTitle">
  
            </div>
  
            
  
            <div class="input-group">
  
                <label>SEO Meta Description</label>
  
                <textarea name="seo_desc" id="seoDesc" style="height: 80px;"></textarea>
  
            </div>
  
  
  
            <div class="row">
  
               <div class="input-group">
  
                   <label>Initial Views</label>
  
                   <input type="number" name="views" value="124" placeholder="Fake it till you make it">
  
               </div>
  
               <div class="toggle-wrap">
  
                   <span class="toggle-label">Enable Comments</span>
  
                   <label class="switch">
  
                     <input type="checkbox" checked>
  
                     <span class="slider"></span>
  
                   </label>
  
               </div>
  
            </div>
  
  
  
            <div style="height: 30px;"></div>
  
            
  
            <button type="submit" style="height: 70px; font-size: 1.2rem; margin-bottom: 20px;">PUBLISH TO NETWORK</button>
  
            
  
            <div style="text-align: center;">
  
                <button type="button" class="btn-secondary" onclick="copySchema()" style="width: auto; opacity: 0.5;">ðŸ“‹ Copy DB Upgrade SQL</button>
  
            </div>
  
  
  
        </form>
  
    </div>
  
    
  
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
    
  
    <script>
  
      const SUPABASE_URL = 'https://ckumhowhucbbmpdeqkrl.supabase.co';
  
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdW1ob3dodWNiYm1wZGVxa3JsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NzQ3NjcsImV4cCI6MjA4MzQ1MDc2N30.yIJ1diGLWjtLWm8P2D5flF2nd0xPKn_8x2RR3DlIrag';
  
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  
  
  
      // Load Key
  
      const savedKey = localStorage.getItem('openai_key');
  
      if(savedKey) document.getElementById('apiKey').value = savedKey;
  
  
  
      // Elements
  
      const preview = document.getElementById('imagePreview');
  
      const urlInput = document.getElementById('urlInput');
  
      const toast = document.getElementById('toast');
  
      const aiStatus = document.getElementById('aiStatus');
  
  
  
      // Show/Hide Toast
  
      function showToast() {
  
          toast.classList.add('show');
  
          setTimeout(() => toast.classList.remove('show'), 3000);
  
      }
  
  
  
      // URL Preview
  
      urlInput.addEventListener('input', (e) => {
  
          const url = e.target.value;
  
          if(url && (url.startsWith('http'))) {
  
              preview.style.backgroundImage = `url(${url})`;
  
              preview.style.display = 'block';
  
              document.getElementById('imageUrl').value = url;
  
          }
  
      });
  
  
  
      // AI AUTO-GENERATOR
  
      document.getElementById('magicBtn').addEventListener('click', async () => {
  
          const key = document.getElementById('apiKey').value;
  
          const title = document.getElementById('titleInput').value;
  
          const context = document.getElementById('aiPrompt').value;
  
  
  
          if(!key || !title) { 
  
              aiStatus.textContent = "ERROR: API Key and Title required.";
  
              aiStatus.style.color = "red";
  
              return; 
  
          }
  
  
  
          aiStatus.textContent = "NEURAL LINK ESTABLISHED... PROCESSING...";
  
          aiStatus.style.color = "var(--accent2)";
  
          
  
          const systemPrompt = `You are the backend for a high-end video production blog. 
  
          Return ONLY a raw JSON object (no markdown formatting) with these keys:
  
          {
  
              "content": "HTML string with <h2>, <p class='lead'>, <p>, <ul>, <strong>. Professional, edgy, technical tone.",
  
              "excerpt": "One punchy sentence summary.",
  
              "seo_title": "SEO optimized title (under 60 chars)",
  
              "seo_desc": "SEO meta description (under 160 chars)",
  
              "category": "One of: Strategy, Tech, Production",
  
              "tags": "comma, separated, list"
  
          }`;
  
  
  
          const userPrompt = `Write a blog post titled "${title}". Context: ${context}. Keep it technical and sharp.`;
  
  
  
          try {
  
              const res = await fetch('https://api.openai.com/v1/chat/completions', {
  
                  method: 'POST',
  
                  headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${key}` },
  
                  body: JSON.stringify({
  
                      model: "gpt-4-turbo",
  
                      messages: [
  
                          { role: "system", content: systemPrompt },
  
                          { role: "user", content: userPrompt }
  
                      ],
  
                      temperature: 0.7,
  
                      response_format: { type: "json_object" }
  
                  })
  
              });
  
  
  
              const data = await res.json();
  
              if(data.error) throw new Error(data.error.message);
  
              
  
              const result = JSON.parse(data.choices[0].message.content);
  
              
  
              // Populate Fields
  
              document.getElementById('contentArea').value = result.content;
  
              document.getElementById('excerptInput').value = result.excerpt;
  
              document.getElementById('seoTitle').value = result.seo_title;
  
              document.getElementById('seoDesc').value = result.seo_desc;
  
              document.getElementById('catInput').value = result.category || 'Tech';
  
              
  
              aiStatus.textContent = "GENERATION COMPLETE.";
  
              aiStatus.style.color = "var(--success)";
  
  
  
          } catch (err) {
  
              console.error(err);
  
              aiStatus.textContent = "AI FAIL: " + err.message;
  
              aiStatus.style.color = "red";
  
          }
  
      });
  
  
  
      // Auto-Slug
  
      function generateSlug(val) {
  
          const slug = val.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');
  
          document.getElementById('slugInput').value = slug;
  
      }
  
  
  
      // File Upload
  
      const fileInput = document.getElementById('fileInput');
  
      fileInput.addEventListener('change', async (e) => {
  
          const file = e.target.files[0];
  
          if (!file) return;
  
  
  
          const pass = document.getElementById('passcode').value;
  
          if(pass !== 'otp2026') { alert("Enter Security Code First"); return; }
  
  
  
          // Local Preview
  
          const reader = new FileReader();
  
          reader.onload = (e) => {
  
              preview.style.backgroundImage = `url(${e.target.result})`;
  
              preview.style.display = 'block';
  
          };
  
          reader.readAsDataURL(file);
  
  
  
          try {
  
              const fileExt = file.name.split('.').pop();
  
              const fileName = `${Date.now()}.${fileExt}`;
  
              const { data, error } = await supabase.storage.from('uploads').upload(fileName, file);
  
              if (error) throw error;
  
              
  
              const { data: { publicUrl } } = supabase.storage.from('uploads').getPublicUrl(fileName);
  
              document.getElementById('imageUrl').value = publicUrl;
  
              
  
          } catch (error) {
  
              alert("Upload Failed: " + error.message);
  
          }
  
      });
  
  
  
      // Main Submit
  
      document.getElementById('postForm').addEventListener('submit', async (e) => {
  
          e.preventDefault();
  
          
  
          const pass = document.getElementById('passcode').value;
  
          if(pass !== 'otp2026') { alert("ACCESS DENIED"); return; }
  
          
  
          const formData = new FormData(e.target);
  
          
  
          // Build Object
  
          const newPost = {
  
              title: formData.get('title'),
  
              slug: formData.get('slug'),
  
              image_url: formData.get('image_url') || document.getElementById('urlInput').value,
  
              excerpt: formData.get('excerpt'),
  
              content: formData.get('content'),
  
              published: true,
  
              // New Fields - Note: These require DB columns. If missing, Supabase might ignore or error.
  
              category: formData.get('category'),
  
              author: formData.get('author'),
  
              seo_title: formData.get('seo_title'),
  
              seo_desc: formData.get('seo_desc'),
  
              views: parseInt(formData.get('views') || 0)
  
          };
  
          
  
          // Handle Date
  
          const pubDate = formData.get('published_at');
  
          if(pubDate) newPost.created_at = new Date(pubDate).toISOString();
  
  
  
          try {
  
              const { error } = await supabase.from('posts').insert([newPost]);
  
              
  
              if(error) {
  
                  // Fallback for schema mismatch
  
                  console.warn("Full insert failed, trying basic insert...", error);
  
                  const basicPost = {
  
                      title: newPost.title,
  
                      slug: newPost.slug,
  
                      image_url: newPost.image_url,
  
                      excerpt: newPost.excerpt,
  
                      content: newPost.content,
  
                      published: true
  
                  };
  
                  const { error: error2 } = await supabase.from('posts').insert([basicPost]);
  
                  if(error2) throw error2;
  
                  alert("Warning: Post published but some advanced fields were not saved because the database is outdated. Use the 'Copy DB Upgrade' button.");
  
              }
  
  
  
              // SUCCESS
  
              showToast();
  
              
  
              setTimeout(() => {
  
                  // e.target.reset(); // Optional: keep data for multiple variants?
  
                  // document.getElementById('imagePreview').style.display = 'none';
  
              }, 1000);
  
              
  
          } catch (err) {
  
              console.error(err);
  
              alert("DB ERROR: " + err.message);
  
          }
  
      });
  
  
  
      // Helper for User
  
      function copySchema() {
  
          const sql = `
  
          alter table posts 
  
          add column if not exists category text,
  
          add column if not exists author text default 'OTP Admin',
  
          add column if not exists seo_title text,
  
          add column if not exists seo_desc text,
  
          add column if not exists views int8 default 0;
  
          `;
  
          navigator.clipboard.writeText(sql);
  
          alert("SQL Copied to Clipboard! Run this in Supabase SQL Editor to enable all features.");
  
      }
  
    </script>
  
  
  
  </body>
  
  </html>
  
  
